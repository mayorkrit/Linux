# Установка и обновления системы Linux. Основы администрирования.


## Contents	
[Установка ОС](#part-1-установка-ос)  
[Создание пользователя](#part-2-создание-пользователя)
[Настройка сети ОС](#part-3-настройка-сети-ос)   
[Обновление ОС](#part-4-обновление-ос)  
[Использование команды  sudo](#part-5-использование-команды-sudo)  
[Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)  
[Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)  
[Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)   
[Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)   
[Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)   
[Использование утилиты df](#part-11-использование-утилиты-df)    
[Использование утилиты du](#part-12-использование-утилиты-du)    
[Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)    
[Работа с системными журналами](#part-14-работа-с-системными-журналами)     
[Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)    



## Part 1. Установка ОС

 Установка Ubuntu 20.04 Server LTS без графического интерфейса.

![](../src/part1.png)

## Part 2. Создание пользователя

Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу adm.

![](../src/part2.png)

## Part 3. Настройка сети ОС

 Задать название машины вида user-1

![](../src/part3-1.png)

 Установить временную зону, соответствующую вашему текущему местоположению.

![](../src/part3-2.png)

 Вывести названия сетевых интерфейсов с помощью консольной команды.
 
Loopback - канал коммуникации с одной конечной точкой. Любые сообщения, посылаемые на этот канал, немедленно принимаются тем же самым каналом. Любые сообщения, которые отправляются с этого интерфейса, но у которых адрес не Loopback Interface, отбрасываются. В компьютерах таким адресом loopback interface является адрес 127.0.0.1, он фиксированный и изменению не подлежит. На Unix-like системах loopback interface называется lo или lo0.


![](../src/part3-3.png)

 Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера.

DHCP
Для работы по сети любому устройству требуется IP-адрес. В протоколе IPv4 это числовой идентификатор, состоящий из 4 разрядов, каждый из которых отделяется точкой, без него устройство не может быть определено в сетевой инфраструктуре. 
Прикладной протокол DHCP выполняет всю работу по подбору сетевых настроек автоматически, без необходимости присваивать вручную каждому устройству свой IP-адрес. Это очень упрощает работу системного администратора в случае расширения сети.

![](../src/part3-4.png)

 Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).

![](../src/part3-5-2.png)
![](../src/part3-5-1.png)

 Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

![](../src/part3-6.png)
![](../src/part3-6-1.png)
![](../src/part3-6-4.png)
![](../src/part3-6-2.png)
![](../src/part3-6-3.png)

 Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.

![](../src/part3-7.png)
![](../src/part3-7-1.png)
![](../src/part3-7-2.png)

## Part 4. Обновление ОС
 Обновить системные пакеты до последней на момент выполнения задания версии.

![](../src/part4.png)

## Part 5. Использование команды **sudo**

 Разрешить пользователю, созданному в Part 2, выполнять команду sudo.

![](../src/part5.png)
![](../src/part5-1.png)
![](../src/part5-2.png)
![](../src/part5-3.png)

## Part 6. Установка и настройка службы времени

 Настроить службу автоматической синхронизации времени.

![](../src/part6.png)
![](../src/part6-1.png)

## Part 7. Установка и использование текстовых редакторов 

 Установить текстовые редакторы VIM (+ любые два по желанию NANO, MCEDIT, JOE и т.д.)

 1.installing
 
**sudo apt install vim**

**sudo apt install nano**

**sudo apt install mcedit**

 2.create and edit files 

__vim test_vim.txt__

vim: wq - safe and quit
![](../src/part7-1.png)

nano ctrl + x + y + return - to quit and save
![](../src/part7-2.png)


mcedit F1 + return + F10 - to quit and save
![](../src/part7-3.png)

 edit and exit wighout save

vim :q! - to exit without saving
![](../src/part7-4.png)

nano ctrl + x + y - to exit without saving
![](../src/part7-5.png)

mcedit F10 + chose NO + return
![](../src/part7-6.png)

 /_0-0_\

__VIM__

/ - to find

![](../src/part7-7.png)

vim search
![](../src/part7-8.png)

__NANO__

ctrl + w - to find in nano
nano search ctrl + \ - to replase in nano

![](../src/part7-9.png)
![](../src/part7-10.png)
![](../src/part7-11.png)


__MCEDIT__

F7 - to search

search result 

F4 - to replase

![](../src/part7-12.png)
![](../src/part7-13.png)
![](../src/part7-14.png)


## Part 8. Установка и базовая настройка сервиса **SSHD**

 Installing and basic setup of the SSHD service

**sudo apt-get install openssh-server sudo systemctl enable ssh** - to enable ssh on boot

![](../src/part8.png)
![](../src/part8-1.png)

 ssh статус

__sudo ufw allow ssh__  
__sudo ufw enable__

__sudo ufw status__

![](../src/part8-2.png)


sudo vim /etc/ssh/sshd_config

![](../src/part8-3.png)

service ssh restart

netstat 

![](../src/part8-4.png)


_Отображаются активные TCP-подключения, порты, на которых компьютер прослушивается, статистика Ethernet, таблица маршрутизации IP-адресов, статистика IPv4 (для протоколов IP, ICMP, TCP и UDP) и Статистика IPv6 (для протоколов IPv6, ICMPv6, TCP по IPv6 и UDP через IPv6). При использовании без параметров эта команда отображает активные TCP-подключения._

-a	    Отображает все активные TCP-подключения и порты TCP и UDP, прослушиваемые компьютером.

-b	    Отображает исполняемый файл, участвующий в создании каждого подключения или порта прослушивания. В некоторых случаях хорошо известные исполняемые объекты размещают несколько независимых компонентов, и в этих случаях отображается последовательность компонентов, участвующих в создании подключения или порта прослушивания. В этом случае имя исполняемого файла находится в [] в нижней части, в верхней — это компонент, который он вызвал, и так далее, пока не достигнет TCP/IP. Обратите внимание, что этот параметр может занимать много времени и не будет работать, если у вас нет достаточных разрешений.

-E	    Отображает статистику Ethernet, например число отправленных и полученных байтов и пакетов. Этот параметр можно сочетать с -s.

-n	    Отображает активные TCP-подключения, однако адреса и номера портов выражаются в числовом виде, и для определения имен не выполняется никаких попыток.

-o	    Отображает активные TCP-подключения и включает идентификатор процесса (PID) для каждого подключения. приложение, основанное на PID, можно найти на вкладке процессы в Windows диспетчере задач. Этот параметр можно сочетать с параметрами -a, -nи -p.

-p      Показывает соединения для протокола, заданного протоколом. В этом случае протоколом может быть TCP, UDP, TCPv6 или UDPv6. Если этот параметр используется вместе с -s для вывода статистики по протоколу, протокол может принимать значение TCP, UDP, ICMP, IP, tcpv6, udpv6, ICMPv6 или IPv6.

-S	    Отображает статистику по протоколу. По умолчанию для протоколов TCP, UDP, ICMP и IP отображается статистика. Если установлен протокол IPv6, для протоколов TCP через IPv6, UDP через IPv6, ICMPv6 и IPv6 отображаются статистические данные. Параметр -p можно использовать для указания набора протоколов.

-r	    Отображает содержимое таблицы IP-маршрутизации. Это эквивалентно команде Route Print.
	Повторно отображает выбранную информацию каждый интервал в секундах. Нажмите клавиши CTRL + C, чтобы прерывать повторное отображение. Если этот параметр не указан, эта команда выводит выбранные данные только один раз.

/?	Отображение справки в командной строке.



ps -aux | grep sshd output ps 

**-a - выбрать все процессы;**\
**-u, (U) - выбрать процессы пользователя.**\
**-f - вывести максимум доступных данных, например, количество потоков;**


![](../src/part8-5.png)

## Part 9. Установка и использование утилит **top**, **htop**

- утилита top предустановлена в UNIX-системах, поэтому для запуска вам достаточно подключиться к серверу по SSH и выполнить команду top.

![](../src/part9-top-2.png)

Слева вверху указано текущее время системы, далее:

Up — время работы системы с последнего запуска.

User — количество текущих пользователей.

Load average — средняя нагрузка на сервер: отображаются значения за одну, пять и 15 минут назад. 

Tasks — общее количество запущенных процессов в разных статусах (running — выполняемые; sleeping — в ожидании; stopped — остановленные; zombie — «зомби», дочерние процессы, ожидающие завершения родительского процесса).

Cpu(s) — процент времени процессора, затраченного на выполнение процессов, в том числе:

us — пользовательские процессы (высокое значение данного показателя может указывать, в том числе, на проблемы в коде сайта, необходимость его оптимизации);

sy — процессы ядра;

id — неиспользуемые ресурсы (чем выше этот показатель, тем лучше);

wa — операции ввода/вывода, т.е. дисковые операции.

Mem, Swap — сведения об использовании оперативной памяти (total — общий объем, free — объем свободной памяти, used — объем использованной памяти).

![](../src/part9-top-top-3.png)
![](../src/part9-users-4.png)
![](../src/part9-TOP-LOAD-AVERAGE-5.png)
![](../src/part9-top-tasks-6.png)
![](../src/part9-7.png)

T — сортировка по времени работы процесса 


и M — сортировка по используемой памяти

PID -1436-mexmem-maxtime

![](../src/shift-m.png)


htop
![](../src/htop.png)

sorted-cpu

![](../src/htop-sorted-cpu.png)

htop-sorted-pid

![](../src/htop-sorted-pid.png)


htop-sorted-mem

![](../src/htop-sorted-mem.png)

htop-sorted-time

![](../src/htop-sorted-time.png)


htop-sshd
![](../src/htop-hhd.png)

htop-syslog
![](../src/htop-syslog.png)

htop-syslog-search
![](../src/htop-syslog-poisk.png)

htop-hostname, clock и uptime

![](../src/htop-last.png)


## Part 10. Использование утилиты **fdisk**


![](../src/10.png)
VBOX HARDSIDK - название\
10gb - размер\
20971520 - количество секторов
![](../src/swap.png)


## Part 11. Использование утилиты **df** 

Using the df utility

![](../src/11.png)

Все данные выводятся в килобайтах.

`df -h` 
-h - выводить размеры в читаемом виде, в мегабайтах или гигабайтах;

![](../src/11-1.png)

размер корневого раздела - Size

размер занятого пространства - Used

размер свободного пространства - Avail

процент использования - Use%

Gb

![](../src/раздел.png)


df -Th
![](../src/dfth.png) 

тип файловой системы для раздела - ext4

## Part 12. Использование утилиты **du**

**/home /var/log and /var**
![](../src/12.png) 

**для человеков**
![](../src/12-2.png) 

**du for all contents in /var/log**
![](../src/12-3.png) 

## Part 13. Установка и использование утилиты **ncdu**

`sudo apt-get install ncdu`
![](../src/ncdu-install.png) 

ncdu for /home

`ncdu /home`
![](../src/homencdu.png) 

ncdu for /var

`ncdu /var`
![](../src/ncduvar.png) 

ncdu for /var/log

`ncdu /var/log`
![](../src/ncduvarlog.png) 

## Part 14. Работа с системными журналами

vim  /var/log/dmesg

![](../src/14-1.png) 

vim /var/log/syslog

![](../src/14-2.png) 

vim /var/log/auth.log

![](../src/14-3.png) 

last login

![](../src/14-auth.png) 


sshd restart logs

`sudo systemctl restart ssh.service`

![](../src/14-restart.png) 

## Part 15. Использование планировщика заданий **CRON**

`crontab -e`

![](../src/KUM.png) 

